Index: app/src/main/java/com/hcmus/forumus_client/ui/post/detail/CommentAdapter.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.hcmus.forumus_client.ui.post.detail\r\n\r\nimport android.view.LayoutInflater\r\nimport android.view.View\r\nimport android.view.ViewGroup\r\nimport android.widget.ImageView\r\nimport android.widget.TextView\r\nimport androidx.recyclerview.widget.RecyclerView\r\nimport coil.load\r\nimport coil.transform.CircleCropTransformation\r\nimport com.hcmus.forumus_client.R\r\nimport com.hcmus.forumus_client.data.model.Comment\r\n\r\nimport android.widget.ImageButton\r\nimport com.hcmus.forumus_client.data.model.VoteState\r\n\r\nclass CommentAdapter(\r\n    private val listener: CommentInteractionListener\r\n) : RecyclerView.Adapter<CommentAdapter.CommentViewHolder>() {\r\n\r\n    interface CommentInteractionListener {\r\n        fun onUpvote(comment: Comment)\r\n        fun onDownvote(comment: Comment)\r\n        fun onReply(comment: Comment)\r\n    }\r\n\r\n    private val comments = mutableListOf<Comment>()\r\n    private var replies = mapOf<String, List<Comment>>()\r\n    private var highlightedCommentId: String? = null\r\n    private var postAuthorName: String? = null\r\n\r\n    fun submitList(newComments: List<Comment>) {\r\n        comments.clear()\r\n        comments.addAll(newComments)\r\n        notifyDataSetChanged()\r\n    }\r\n    \r\n    fun setReplies(newReplies: Map<String, List<Comment>>) {\r\n        replies = newReplies\r\n        notifyDataSetChanged()\r\n    }\r\n    \r\n    fun setHighlightedComment(commentId: String?) {\r\n        highlightedCommentId = commentId\r\n        notifyDataSetChanged()\r\n    }\r\n    \r\n    fun setPostAuthorName(name: String?) {\r\n        postAuthorName = name\r\n        notifyDataSetChanged()\r\n    }\r\n\r\n    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): CommentViewHolder {\r\n        val view = LayoutInflater.from(parent.context)\r\n            .inflate(R.layout.item_comment, parent, false)\r\n        return CommentViewHolder(view)\r\n    }\r\n\r\n    override fun onBindViewHolder(holder: CommentViewHolder, position: Int) {\r\n        holder.bind(comments[position])\r\n    }\r\n\r\n    override fun getItemCount(): Int = comments.size\r\n\r\n    inner class CommentViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {\r\n        private val ivAvatar: ImageView = itemView.findViewById(R.id.iv_comment_avatar)\r\n        private val tvUsername: TextView = itemView.findViewById(R.id.tv_comment_username)\r\n        private val tvTime: TextView = itemView.findViewById(R.id.tv_comment_time)\r\n        private val tvContent: TextView = itemView.findViewById(R.id.tv_comment_text)\r\n        private val tvVotes: TextView = itemView.findViewById(R.id.tv_comment_votes)\r\n        private val tvAuthorTag: TextView = itemView.findViewById(R.id.tv_author_tag)\r\n        \r\n        private val btnUpvote: ImageButton = itemView.findViewById(R.id.btn_comment_upvote)\r\n        private val btnDownvote: ImageButton = itemView.findViewById(R.id.btn_comment_downvote)\r\n        private val btnReply: View = itemView.findViewById(R.id.btn_comment_reply)\r\n        private val btnCollapse: View = itemView.findViewById(R.id.btn_collapse)\r\n\r\n        private val tvReplyCount: TextView = itemView.findViewById(R.id.tv_reply_count)\r\n        private val llNestedComments: android.widget.LinearLayout = itemView.findViewById(R.id.ll_nested_comments)\r\n        private val llCommentBody: View = itemView.findViewById(R.id.ll_comment_body)\r\n        \r\n        // Track expansion state\r\n        private var isExpanded = false\r\n\r\n        fun bind(comment: Comment) {\r\n            // Highlighting Logic\r\n            if (comment.id == highlightedCommentId) {\r\n                llCommentBody.setBackgroundColor(0x1A000000) // 10% Black Overlay\r\n            } else {\r\n                llCommentBody.setBackgroundColor(android.graphics.Color.TRANSPARENT)\r\n            }\r\n            \r\n            tvUsername.text = comment.authorName\r\n            tvContent.text = comment.content\r\n            tvVotes.text = comment.voteCount.toString()\r\n            tvTime.text = relativeTime(comment.timestamp)\r\n\r\n            // Author Tag Logic\r\n            if (comment.authorName == postAuthorName) {\r\n                tvAuthorTag.visibility = View.VISIBLE\r\n            } else {\r\n                tvAuthorTag.visibility = View.GONE\r\n            }\r\n            \r\n            updateVoteButtons(comment.userVote)\r\n\r\n            if (!comment.authorAvatarUrl.isNullOrBlank()) {\r\n                 ivAvatar.load(comment.authorAvatarUrl) {\r\n                    crossfade(true)\r\n                    placeholder(R.drawable.ic_default_profile)\r\n                    error(R.drawable.ic_default_profile)\r\n                    transformations(CircleCropTransformation())\r\n                }\r\n            } else {\r\n                 ivAvatar.setImageResource(R.drawable.ic_default_profile)\r\n            }\r\n            \r\n            btnUpvote.setOnClickListener { listener.onUpvote(comment) }\r\n            btnDownvote.setOnClickListener { listener.onDownvote(comment) }\r\n            btnReply.setOnClickListener { listener.onReply(comment) }\r\n            \r\n            // Handle Replies\r\n            val commentReplies = replies[comment.id]\r\n            if (!commentReplies.isNullOrEmpty()) {\r\n                tvReplyCount.visibility = View.VISIBLE\r\n                val replyText = if (isExpanded) \"Hide replies\" else \"View ${commentReplies.size} replies\"\r\n                tvReplyCount.text = replyText\r\n                \r\n                // If expanded, ensure views are there\r\n                if (isExpanded) {\r\n                    llNestedComments.visibility = View.VISIBLE\r\n                    if (llNestedComments.childCount == 0) {\r\n                        inflateReplies(commentReplies)\r\n                    }\r\n                } else {\r\n                    llNestedComments.visibility = View.GONE\r\n                }\r\n                \r\n                tvReplyCount.setOnClickListener {\r\n                    isExpanded = !isExpanded\r\n                    // Update text immediately\r\n                    tvReplyCount.text = if (isExpanded) \"Hide replies\" else \"View ${commentReplies.size} replies\"\r\n                    \r\n                    if (isExpanded) {\r\n                        llNestedComments.visibility = View.VISIBLE\r\n                        if (llNestedComments.childCount == 0) {\r\n                            inflateReplies(commentReplies)\r\n                        }\r\n                    } else {\r\n                        llNestedComments.visibility = View.GONE\r\n                    }\r\n                }\r\n            } else {\r\n                tvReplyCount.visibility = View.GONE\r\n                llNestedComments.visibility = View.GONE\r\n            }\r\n        }\r\n        \r\n        private fun inflateReplies(repliesList: List<Comment>) {\r\n            llNestedComments.removeAllViews()\r\n            val inflater = LayoutInflater.from(itemView.context)\r\n            \r\n            for (reply in repliesList) {\r\n                val replyView = inflater.inflate(R.layout.item_comment, llNestedComments, false)\r\n                \r\n                val rUsername: TextView = replyView.findViewById(R.id.tv_comment_username)\r\n                val rContent: TextView = replyView.findViewById(R.id.tv_comment_text)\r\n                val rTime: TextView = replyView.findViewById(R.id.tv_comment_time)\r\n                val rVotes: TextView = replyView.findViewById(R.id.tv_comment_votes)\r\n                val rAvatar: ImageView = replyView.findViewById(R.id.iv_comment_avatar)\r\n                val rBtnUp: ImageButton = replyView.findViewById(R.id.btn_comment_upvote)\r\n                val rBtnDown: ImageButton = replyView.findViewById(R.id.btn_comment_downvote)\r\n                val rBtnReply: View = replyView.findViewById(R.id.btn_comment_reply)\r\n                val rTvReplyCount: TextView = replyView.findViewById(R.id.tv_reply_count)\r\n                val rTvAuthorTag: TextView = replyView.findViewById(R.id.tv_author_tag)\r\n                \r\n                rUsername.text = reply.authorName\r\n                rContent.text = reply.content\r\n                rVotes.text = reply.voteCount.toString()\r\n                rTime.text = relativeTime(reply.timestamp)\r\n                rTvReplyCount.visibility = View.GONE \r\n\r\n                // Author Tag Logic for Reply\r\n                if (reply.authorName == postAuthorName) {\r\n                    rTvAuthorTag.visibility = View.VISIBLE\r\n                } else {\r\n                    rTvAuthorTag.visibility = View.GONE\r\n                } \r\n                \r\n                if (!reply.authorAvatarUrl.isNullOrBlank()) {\r\n                     rAvatar.load(reply.authorAvatarUrl) {\r\n                        placeholder(R.drawable.ic_default_profile)\r\n                        error(R.drawable.ic_default_profile)\r\n                        transformations(CircleCropTransformation())\r\n                    }\r\n                } else {\r\n                     rAvatar.setImageResource(R.drawable.ic_default_profile)\r\n                }\r\n                \r\n                // Set vote icons for reply\r\n                when (reply.userVote) {\r\n                    VoteState.UP -> {\r\n                        rBtnUp.setImageResource(R.drawable.ic_upvote_filled)\r\n                        rBtnDown.setImageResource(R.drawable.ic_downvote)\r\n                    }\r\n                    VoteState.DOWN -> {\r\n                        rBtnUp.setImageResource(R.drawable.ic_upvote)\r\n                        rBtnDown.setImageResource(R.drawable.ic_downvote_filled)\r\n                    }\r\n                    VoteState.NONE -> {\r\n                        rBtnUp.setImageResource(R.drawable.ic_upvote)\r\n                        rBtnDown.setImageResource(R.drawable.ic_downvote)\r\n                    }\r\n                }\r\n                \r\n                rBtnUp.setOnClickListener { listener.onUpvote(reply) }\r\n                rBtnDown.setOnClickListener { listener.onDownvote(reply) }\r\n                // Disable replies for nested comments (2-level depth limit)\r\n                rBtnReply.visibility = View.GONE\r\n                rBtnReply.setOnClickListener { /* no-op */ }\r\n                \r\n                llNestedComments.addView(replyView)\r\n            }\r\n        }\r\n        \r\n        private fun updateVoteButtons(userVote: VoteState) {\r\n            when (userVote) {\r\n                VoteState.UP -> {\r\n                    btnUpvote.setImageResource(R.drawable.ic_upvote_filled)\r\n                    btnDownvote.setImageResource(R.drawable.ic_downvote)\r\n                }\r\n                VoteState.DOWN -> {\r\n                    btnUpvote.setImageResource(R.drawable.ic_upvote)\r\n                    btnDownvote.setImageResource(R.drawable.ic_downvote_filled)\r\n                }\r\n                VoteState.NONE -> {\r\n                    btnUpvote.setImageResource(R.drawable.ic_upvote)\r\n                    btnDownvote.setImageResource(R.drawable.ic_downvote)\r\n                }\r\n            }\r\n        }\r\n\r\n        private fun relativeTime(createdMillis: Long): String {\r\n            val now = System.currentTimeMillis()\r\n            val diff = (now - createdMillis).coerceAtLeast(0)\r\n            val minute = 60_000L\r\n            val hour = 60 * minute\r\n            val day = 24 * hour\r\n            val year = 365 * day\r\n            return when {\r\n                diff < minute -> \"just now\"\r\n                diff < hour -> \"${diff / minute}m ago\"\r\n                diff < day -> \"${diff / hour}h ago\"\r\n                diff < year -> \"${diff / day}d ago\"\r\n                else -> \"${diff / year}y ago\"\r\n            }\r\n        }\r\n    }\r\n}\r\n
===================================================================
diff --git a/app/src/main/java/com/hcmus/forumus_client/ui/post/detail/CommentAdapter.kt b/app/src/main/java/com/hcmus/forumus_client/ui/post/detail/CommentAdapter.kt
--- a/app/src/main/java/com/hcmus/forumus_client/ui/post/detail/CommentAdapter.kt	(revision 5108f36d13d6561447627ad1cbd812b43fd746dd)
+++ b/app/src/main/java/com/hcmus/forumus_client/ui/post/detail/CommentAdapter.kt	(date 1765117440210)
@@ -249,10 +249,10 @@
             val year = 365 * day
             return when {
                 diff < minute -> "just now"
-                diff < hour -> "${diff / minute}m ago"
-                diff < day -> "${diff / hour}h ago"
-                diff < year -> "${diff / day}d ago"
-                else -> "${diff / year}y ago"
+                diff < hour -> "${diff / minute}m"
+                diff < day -> "${diff / hour}h"
+                diff < year -> "${diff / day}d"
+                else -> "${diff / year}y"
             }
         }
     }
